{% extends 'base_page.html' %}

{% block Titulo %}
	<meta charset="utf-8">
    <title>Meus Projetos</title>
{% endblock %}

{% block recrusos_necessarios %}
{% load staticfiles %}

<!-- BOOTSTRAP -->
<link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet"/>

<!-- DATATABLE -->
<link rel="stylesheet" type="text/css" href="{% static 'datatable/DataTables-1.10.11/css/dataTables.bootstrap.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'datatable/plugins/responsivo/Responsive-2.0.2/css/responsive.bootstrap.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'datatable/plugins/select/Select-1.1.2/css/select.bootstrap.min.css' %}"/>

<script src="{% static 'datatable/DataTables-1.10.11/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'datatable/DataTables-1.10.11/js/dataTables.bootstrap.min.js' %}"></script>
<script src="{% static 'datatable/plugins/select/Select-1.1.2/js/dataTables.select.min.js' %}"></script>

<!-- JQUERY UI DATAPICKER -->
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css">

<!-- JQUERY AUTOCOMPLETE EDITABLE -->
<link rel="stylesheet" type="text/css" href="{% static 'jquery/jquery-editable-select/jquery.editable-select.min.css' %}" />
<script src="{% static 'jquery/jquery-editable-select/jquery.editable-select.min.js' %}"></script>

<!-- jvectormap -->
<link rel="stylesheet" href="{% static 'plugins/jvectormap/jquery-jvectormap-1.2.2.css' %}">

<!-- CUSTOM -->
<!-- <link href="{% static 'styles/menu_simples_responsivo.css' %}" rel="stylesheet"/> -->
<link rel="stylesheet" href="{% static 'styles/projeto/projeto.css' %}">
<script src="{% static 'scripts/padrao/controle_botoes.js' %}"></script>
<script src="{% static 'scripts/protocolo/protocolo.js' %}"></script>


<style type="text/css">
.uppercase{ 
    text-transform: uppercase;
}

.lowercase{ 
    text-transform: uppercase;
}

.center_align{ 
    text-align: center;
}

.left_align{ 
	padding-left: 8px;
    text-align: left;
}

.right_align{ 
    text-align: right;
}

.link_desabilitado {
     pointer-events: none;
     cursor: default;
     opacity: 0.6;
}

.div_desabilitado {
	display: none;
    z-index: 1000;
    background-color: lightgrey;
    opacity: 0.6;
    pointer-events: none;
}

.dataTables_paginate {
	position: relative;
    display: block;
    top: 30px;
}

label {
    font-weight: normal !important;
}

.label_metric{
    font-size: 12px;
    padding: 0px !important;
    margin-top: -3px;
}


.compact_row td {
    padding-bottom: 2px !important;
    font-size: 11px;
    margin-bottom: 0px;
}

.clickable {
    cursor:pointer;
}

th.compact {
    font-size: 11px;
}

.titulo{
    margin-left: 15px;
    margin-top: -5px;
}


#box_problemas .tooltip-inner {
  min-width: 110px;
  max-width: 100%;
}


</style>
{% endblock %}

{% block breadcrumb_title %}
{{ projeto.nome_projeto|title }}
{% endblock %}

{% block breadcrumb_block %}
    <li><a href="/"><i class="fa fa-home"></i> Home</a></li>
    <li><a href="/projeto/{{ repositorio|lower }}">{{ repositorio|title }}</a></li>
    <li class="active">{{ projeto.nome_projeto|title }}</li>
{% endblock %}

{% block conteudo %}
{% load mathfilters %}
<div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-dialog">
        <!--  style="width: 90%"> -->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                <h3 id="myModalLabel">Novo Documento</h3>
            </div>


            <div class="modal-body" style="padding: 30px;">
                <form action="" method="post">
                {% csrf_token %}
                    <div class="row" style="padding-left: 15px; padding-right: 15px">
                        <div style='padding-left: 8px'>
                            <sub>{{ formulario.documento.label }}</sub>
                        </div>
                        {{ formulario.documento }}
                    </div>

                    <div class="row" style="padding-left: 15px; padding-right: 15px">
                        <div style='padding-left: 8px'>
                            <sub>{{ formulario.descricao.label }}</sub>
                        </div>
                        {{ formulario.descricao }}

                    </div>

                    <div class="row">
                        <div class="col-lg-3 col-lg-push-9">
                            <button type="submit" id="bt_submit_documento" class="btn btn-primary form-control" style="position: relative; margin-top: 20px"></button>
                            <!-- <a href="#myModal" role="button" class="btn btn-primary form-control" data-toggle="modal" '  > Adicionar</a>  -->
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!--<h4 class="titulo">Projetos pelo Mundo</h4>-->

<div class="row">
    <div class="col-md-12">
      <div class="box" style="margin-top: -25px; margin-left: 0px; margin-right: 0px;">
        <div class="box-header with-border">
          <h3 class="box-title">Visão Geral</h3>

          <div class="box-tools pull-right">
            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
            </button>
            <div class="btn-group">
              <button type="button" class="btn btn-box-tool" onclick="atualizar_metricas_projeto();">
                <i id='atualizar_metricas_icone' class="fa fa-refresh" style="font-size:15px" aria-hidden="true"></i>
                <!--<i class="fa fa-refresh fa-spin fa-3x fa-1x" ></i>-->
              </button>

            </div>
            <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
          </div>
        </div>
        <!-- /.box-header -->
        <div class="box-body" style="padding-left: 15px;padding-right: 15px;margin-top:0px;padding-top:0px;height: 476px; border-bottom-left-radius: 3px; border-top: none; border-bottom-right-radius: 3px;">
          <div class="row">
            <div class="col-md-8" style='padding-top: 30px;'>
              <p class="text-center">
                <strong>Complexidade</strong>
              </p>

              <div class="chart">
                <!-- Sales Chart Canvas -->
                <canvas id="salesChart" style="background-color: #EEE;height: 280px; width: 703px;" width="703">

                </canvas>
              </div>
              <!-- /.chart-responsive -->


              <div class="row" style="margin-top: 10px; background-color: #fff; margin-left: 0px;margin-right: 0px;margin-bottom: 0px;">
                <div id='box_problemas' class="box-default">

                  <style>
                    .label_problema{
                      color: #8c8c8c;
                    }
                  </style>

                  <div class="box-header with-border">
                    <h5 class="box-title label_problema">Problemas</h5>
                  </div>

                  <div class="box-header with-border" style="padding-left: 0px;padding-right: 0px;">
                    <div class="col-md-3 border-right" style="text-align: center;" data-toggle="tooltip" data-placement="top" title="Análise anterior: {{ estado_atual.estado_anterior.problemas_criticos }} Problemas">
                      <span class="center_align label_problema">Críticos</span>
                      <br>
                      <b>{{ estado_atual.estado_atual.problemas_criticos }}</b>
                        {% if estado_atual.variacao.problemas_criticos == None %}
                        {% else %}
                          {% if estado_atual.variacao.problemas_criticos == 0 %}
                            <span class="description-percentage text-yellow">{{ estado_atual.variacao.problemas_criticos }}%
                          {% else %}
                            {% if estado_atual.estado_atual.problemas_criticos < estado_atual.estado_anterior.problemas_criticos %}
                              <span class="description-percentage text-green">{{ estado_atual.variacao.problemas_criticos }}%
                            {% else %}
                              <span class="description-percentage text-red">{{ estado_atual.variacao.problemas_criticos }}%
                            {% endif %}
                          {% endif %}
                        {% endif %}
                        </span>
                    </div>

                    <div class="col-md-3 border-right" style="text-align: center;" data-toggle="tooltip" data-placement="top" title="Análise anterior: {{ estado_atual.estado_anterior.problemas_importantes }} Problemas">
                      <span class="description-text center_align label_problema">Importantes</span>
                      <br>
                      <b>{{ estado_atual.estado_atual.problemas_importantes }}</b>
                        {% if estado_atual.variacao.problemas_importantes == None %}
                        {% else %}
                          {% if estado_atual.variacao.problemas_importantes == 0 %}
                            <span class="description-percentage text-yellow">{{ estado_atual.variacao.problemas_importantes }}%
                          {% else %}
                            {% if estado_atual.estado_atual.problemas_importantes < estado_atual.estado_anterior.problemas_importantes %}
                              <span class="description-percentage text-green">{{ estado_atual.variacao.problemas_importantes }}%
                            {% else %}
                              <span class="description-percentage text-red">{{ estado_atual.variacao.problemas_importantes }}%
                            {% endif %}
                          {% endif %}
                        {% endif %}
                        </span>
                    </div>

                    <div class="col-md-3 border-right" style="text-align: center;"  data-toggle="tooltip" data-placement="top" title="Análise anterior: {{ estado_atual.estado_anterior.problemas_moderados }} Problemas">
                      <span class="description-text center_align label_problema">Moderados</span>
                      <br>
                      <b>{{ estado_atual.estado_atual.problemas_moderados }}</b>
                        {% if estado_atual.variacao.problemas_moderados == None %}
                        {% else %}
                          {% if estado_atual.variacao.problemas_moderados == 0 %}
                            <span class="description-percentage text-yellow">{{ estado_atual.variacao.problemas_moderados }}%
                          {% else %}
                            {% if estado_atual.estado_atual.problemas_moderados < estado_atual.estado_anterior.problemas_moderados %}
                              <span class="description-percentage text-green">{{ estado_atual.variacao.problemas_moderados }}%
                            {% else %}
                              <span class="description-percentage text-red">{{ estado_atual.variacao.problemas_moderados }}%
                            {% endif %}
                          {% endif %}
                        {% endif %}
                        </span>
                    </div>

                    <div class="col-md-3" style="text-align: center;" data-toggle="tooltip" data-placement="top" title="Análise anterior: {{ estado_atual.estado_anterior.problemas_normais }} Problemas">
                      <span class="description-text center_align label_problema">Simples</span>
                      <br>
                      <b>{{ estado_atual.estado_atual.problemas_normais }}</b>
                        {% if estado_atual.variacao.problemas_normais == None %}
                        {% else %}
                          {% if estado_atual.variacao.problemas_normais == 0 %}
                            <span class="description-percentage text-yellow">{{ estado_atual.variacao.problemas_normais }}%
                          {% else %}
                            {% if estado_atual.estado_atual.problemas_normais < estado_atual.estado_anterior.problemas_normais %}
                              <span class="description-percentage text-green">{{ estado_atual.variacao.problemas_normais }}%
                            {% else %}
                              <span class="description-percentage text-red">{{ estado_atual.variacao.problemas_normais }}%
                            {% endif %}
                          {% endif %}
                        {% endif %}
                        </span>
                    </div>
                  </div>
                </div>







                <!--<div id='box_problemas' class="box_metric box box-default">
                <div class="box-body">
                  <div class="progress_metric" class="progress-group">
                    <strong class="metric_title">Problemas</strong>

                    <strong class="pull-right">
                      {{ estado_atual.estado_atual.total_problemas }} ({{ estado_atual.variacao.total_problemas }}%)
                    </strong>

                  </div>

                  <div class="col-sm-3 col-xs-6">
                    <div class="description-block border-right">
                      <span class="description-text center_align">Críticos</span>
                      <h5 class="description-header"></h5>
                        <b>{{ estado_atual.estado_atual.problemas_criticos }}</b>
                        {% if estado_atual.variacao.problemas_criticos == None %}
                        {% else %}
                          {% if estado_atual.variacao.problemas_criticos == 0 %}
                            <span class="description-percentage text-yellow">{{ estado_atual.variacao.problemas_criticos }}%
                          {% else %}
                            {% if estado_atual.variacao.problemas_criticos > 0 %}
                              <span class="description-percentage text-green">{{ estado_atual.variacao.problemas_criticos }}%
                            {% else %}
                              <span class="description-percentage text-red">{{ estado_atual.variacao.problemas_criticos }}%
                            {% endif %}
                          {% endif %}
                        {% endif %}
                        </span>
                    </div>
                  </div>
                  <!-- /.col --
                  <div class="col-sm-3 col-xs-6">
                    <div class="description-block border-right">
                      <span class="description-text center_align">Importantes</span>
                      <h5 class="description-header"></h5>
                        <b>{{ estado_atual.estado_atual.problemas_importantes }}</b>
                        {% if estado_atual.variacao.problemas_importantes == None %}
                        {% else %}
                          {% if estado_atual.variacao.problemas_importantes == 0 %}
                            <span class="description-percentage text-yellow">{{ estado_atual.variacao.problemas_importantes }}%
                          {% else %}
                            {% if estado_atual.variacao.problemas_importantes > 0 %}
                              <span class="description-percentage text-green">{{ estado_atual.variacao.problemas_importantes }}%
                            {% else %}
                              <span class="description-percentage text-red">{{ estado_atual.variacao.problemas_importantes }}%
                            {% endif %}
                          {% endif %}
                        {% endif %}
                        </span>
                    </div>
                  </div>
                  <!-- /.col --
                  <div class="col-sm-3 col-xs-6">
                    <div class="description-block border-right">
                      <span class="description-text">Moderados</span>
                      <h5 class="description-header"></h5>
                        <b>{{ estado_atual.estado_atual.problemas_moderados }}</b>
                        {% if estado_atual.variacao.problemas_moderados == None %}
                        {% else %}
                          {% if estado_atual.variacao.problemas_moderados == 0 %}
                            <sub><span class="description-percentage text-yellow">({{ estado_atual.variacao.problemas_moderados }}%)</sub>
                          {% else %}
                            {% if estado_atual.variacao.problemas_moderados > 0 %}
                              <sub><span class="description-percentage text-green">(+{{ estado_atual.variacao.problemas_moderados}}%)</sub>
                            {% else %}
                              <sub><span class="description-percentage text-red">({{ estado_atual.variacao.problemas_moderados }}%)</sub>
                            {% endif %}
                          {% endif %}
                        {% endif %}
                        </span>
                    </div>
                  </div>
                  <!-- /.col --
                  <div class="col-sm-3 col-xs-6">
                    <div class="description-block border-right">
                      <span class="description-text">Moderados</span>
                      <h5 class="description-header"></h5>
                        <b>{{ estado_atual.estado_atual.problemas_moderados }}</b>
                        {% if estado_atual.variacao.problemas_moderados == None %}
                        {% else %}
                          {% if estado_atual.variacao.problemas_moderados == 0 %}
                            <sub><span class="description-percentage text-yellow">({{ estado_atual.variacao.problemas_moderados }}%)</sub>
                          {% else %}
                            {% if estado_atual.variacao.problemas_moderados > 0 %}
                              <sub><span class="description-percentage text-green">(+{{ estado_atual.variacao.problemas_moderados}}%)</sub>
                            {% else %}
                              <sub><span class="description-percentage text-red">({{ estado_atual.variacao.problemas_moderados }}%)</sub>
                            {% endif %}
                          {% endif %}
                        {% endif %}
                        </span>
                    </div>
                  </div>
                </div>
              </div>-->







              </div>
            </div>
            <!-- /.col -->
            <div id="box_project_metrics" class="col-md-4"  style="padding-top: 26px;opacity: 0.2;">

              <div id='box_complexidade' class="box_metric box box-default">
                <div class="box-body">
                  <div class="box_metric_hand">
                    <span><i id='complexidade_icone'></i></span>
                  </div>

                  <div class="progress_metric" class="progress-group">
                    <strong class="metric_title">Complexidade</strong>

                    <strong class="pull-right">
                      <a id='complexidade_projeto' data-toggle="tooltip" data-placement="bottom" title="Complexidade do Projeto"></a> /
                      <a id='complexidade_global' data-toggle="tooltip" data-placement="bottom" title="Complexidade de Projetos Externos"></a>
                    </strong>

                    <a data-toggle="tooltip" data-placement="bottom" title="sa à partir de ">
                      <div class="progress xs" style="margin-top: 10px;">
                        <div id='progress_complexidade' class="progress-bar progress-bar-striped active"></div>
                      </div>
                    </a>
                  </div>
                </div>
              </div>

              <div id='box_duplicacao' class="box_metric box box-default">
                <div class="box-body">
                  <div class="box_metric_hand">
                    <span><i id='duplicacao_icone'></i></span>
                  </div>

                  <div class="progress_metric" class="progress-group">
                    <strong class="metric_title">Duplicação</strong>

                    <strong class="pull-right">
                      <a id='duplicacao_projeto' data-toggle="tooltip" data-placement="bottom" title="Duplicação do Projeto"></a>% /
                      <a id='duplicacao_global' data-toggle="tooltip" data-placement="bottom" title="Duplicação de Projetos Externos"></a>%
                    </strong>

                    <a data-toggle="tooltip" data-placement="bottom" title="sa à partir de ">
                      <div class="progress xs" style="margin-top: 10px;">
                        <div id='progress_duplicacao' class="progress-bar  progress-bar-striped active"></div>
                      </div>
                    </a>
                  </div>

                </div>
              </div>

              <div id='box_divida_tecnica' class="box_metric box box-default">
                <div class="box-body">
                  <div class="box_metric_hand">
                    <span><i id="divida_tecnica_icone"></i></span>
                  </div>

                  <div class="progress_metric" class="progress-group">
                    <strong class="metric_title">Dívida Técnica</strong>

                    <strong class="pull-right">
                      <a id='divida_tecnica_projeto' data-toggle="tooltip" data-placement="bottom" title="Dívida Técnica do Projeto"></a>% /
                      <a id='divida_tecnica_global' data-toggle="tooltip" data-placement="bottom" title="Dívida Técnica de Projetos Externos"></a>%
                    </strong>

                    <a data-toggle="tooltip" data-placement="bottom" title="sa à partir de ">
                      <div class="progress xs" style="margin-top: 10px;">
                        <div id='progress_divida_tecnica' class="progress-bar progress-bar-striped active"></div>
                      </div>
                    </a>
                  </div>

                </div>
              </div>

              <div id='box_comentarios' class="box_metric box box-primary">
                <div class="box-body">
                  <div class="box_metric_hand">
                    <span><i id="comentarios_icone"></i></span>
                  </div>

                  <div class="progress_metric" class="progress-group">
                    <strong class="metric_title">Comentários</strong>

                    <strong class="pull-right">
                      <a id='comentarios_projeto' data-toggle="tooltip" data-placement="bottom" title="Comentários do Projeto"></a>% /
                      <a id='comentarios_global' data-toggle="tooltip" data-placement="bottom" title="Comentários de Projetos Externos"></a>%
                    </strong>

                    <a data-toggle="tooltip" data-placement="bottom" title="sa à partir de ">
                      <div class="progress xs" style="margin-top: 10px;">
                        <div id='progress_comentarios' class="progress-bar progress-bar-striped active"></div>
                      </div>
                    </a>
                  </div>

                </div>
              </div>

              <div id='box_codesmells' class="box_metric box box-primary">
                <div class="box-body">
                  <div class="box_metric_hand">
                    <span><i id="codesmells_icone"></i></span>
                  </div>

                  <div class="progress_metric" class="progress-group">
                    <strong class="metric_title">Code Smells</strong>

                    <strong class="pull-right">
                      <a id='codesmells_projeto' data-toggle="tooltip" data-placement="bottom" title="Codesmells do Projeto"></a> /
                      <a id='codesmells_global' data-toggle="tooltip" data-placement="bottom" title="Codesmells de Projetos Externos"></a>
                    </strong>

                    <a data-toggle="tooltip" data-placement="bottom" title="sa à partir de ">
                      <div class="progress xs" style="margin-top: 10px;">
                        <div id='progress_codesmells' class="progress-bar progress-bar-striped active"></div>
                      </div>
                    </a>
                  </div>

                </div>
              </div>


            </div>
            <!-- /.col -->
          </div>
          <!-- /.row -->
        </div>
        <!-- ./box-body -->
      </div>
      <!-- /.box -->
    </div>
</div>

<br>

<div class="row">
	<div class="col-lg-12 col-md-12 col-xs-12">
		<div class="box box-default" style="margin-top: -25px; margin-left: 0px; margin-right: 0px; ">
			<div class="box-heading">
        <div class="box-header with-border">
          <h5 class="box-title">Histórico de Análises</h5>

          <div class="btn-group pull-right" role="group" style='margin-top: -2px;' aria-label="...">
            <a id='bt_adicionar' role="button" class="btn btn-sm btn-primary">
              <i id="atualizando_icone"></i>Analisar Projeto
            </a>

            <a id='bt_config' href='/perfil' role="button" class="btn btn-sm btn-default" style="margin-left: 8px;">
                Configurações
            </a>
          </div>
        </div>
			</div>
			<!-- /.panel-heading -->
		
			<div class="box-body" style="padding-bottom: -10px; margin-top: -5px;">
				<div class="dataTable_wrapper">
				
					<div class='row'>
						
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<table class="table table-bordered table-hover" id="datatable">
                <!--
                referencia.linhas_codigo = formatar_inteiro(self.get_metrica(registro, metrica.linhas_codigo))
                referencia.total_linhas = formatar_inteiro(self.get_metrica(registro, metrica.total_linhas))
                referencia.arquivos = formatar_inteiro(self.get_metrica(registro, metrica.arquivos))
                referencia.classes = formatar_inteiro(self.get_metrica(registro, metrica.classes))
                referencia.metodos = formatar_inteiro(self.get_metrica(registro, metrica.metodos))

                referencia.complexidade_total = formatar_inteiro(self.get_metrica(registro, metrica.complexidade_total))
                referencia.complexidade_metodo = self.get_metrica(registro, metrica.complexidade_metodo)
                referencia.complexidade_classe = self.get_metrica(registro, metrica.complexidade_classe)
                referencia.complexidade_arquivo = self.get_metrica(registro, metrica.complexidade_arquivo)

                referencia.taxa_duplicacao = formatar_float(self.get_metrica(registro, metrica.taxa_duplicacao))
                referencia.taxa_divida_tecnica = formatar_float(self.get_metrica(registro, metrica.taxa_divida_tecnica))
                referencia.total_problemas = formatar_inteiro(self.get_metrica(registro, metrica.total_problemas))
                referencia.problemas_criticos = formatar_inteiro(self.get_metrica(registro, metrica.problemas_criticos))
                referencia.problemas_importantes = formatar_inteiro(self.get_metrica(registro, metrica.problemas_importantes))
                referencia.problemas_moderados = formatar_inteiro(self.get_metrica(registro, metrica.problemas_moderados))
                referencia.problemas_normais = formatar_inteiro(self.get_metrica(registro, metrica.problemas_normais))
                referencia.problemas_simples = formatar_inteiro(self.get_metrica(registro, metrica.problemas_simples))

                referencia.taxa_comentarios
                -->

                <thead>
                  <tr class="linha_cabecalho">
                    <th class='compact center_align'>Data</th>
                    <th class='compact center_align'>Linhas</th>
                    <th class='compact center_align'>Comentários</th>
                    <th class='compact center_align'>Complexidade</th>
                    <th class='compact center_align'>Duplicação</th>
                    <th class='compact center_align'>Dívida Técnica</th>
                    <th class='compact center_align'>Code Smells</th>
                  </tr>
								</thead>

                  <tbody>
                  {% for estado in estados_projeto %}
                    <tr class='compact_row'>
                      {% load humanize %}
                      <td class='compact center_align clickable'>{{ estado.data_revisao|date:"d/m/Y" }}</td>

                      {% if estado.linhas_codigo != None %}
                          <td class='compact center_align clickable'>{{ estado.linhas_codigo|intcomma }}</td>
                      {% else %}
                          <td class='compact center_align clickable'>-</td>
                      {% endif %}

                      {% if estado.taxa_comentarios != None %}
                          <td class='compact center_align clickable'>{{ estado.taxa_comentarios }}%</td>
                      {% else %}
                          <td class='compact center_align clickable'>-</td>
                      {% endif %}

                      {% if estado.complexidade_metodo != None %}
                          <td class='compact center_align clickable'>{{ estado.complexidade_metodo }}%</td>
                      {% else %}
                          <td class='compact center_align clickable'>-</td>
                      {% endif %}

                      {% if estado.taxa_duplicacao != None %}
                          <td class='compact center_align clickable'>{{ estado.taxa_duplicacao }}%</td>
                      {% else %}
                          <td class='compact center_align clickable'>-</td>
                      {% endif %}

                      {% if estado.taxa_divida_tecnica != None %}
                          <td class='compact center_align clickable'>{{ estado.taxa_divida_tecnica }}%</td>
                      {% else %}
                          <td class='compact center_align clickable'>-</td>
                      {% endif %}

                      {% if estado.total_codesmell != None %}
                          <td class='compact center_align clickable'>{{ estado.total_codesmell|intcomma }}</td>
                      {% else %}
                          <td class='compact center_align clickable'>-</td>
                      {% endif %}
                    </tr>

                  {% empty %}
		    						<tr><td style="text-align: center;" colspan="7">Nenhuma Análise Realizada!</td></tr>
								  {% endfor %}
                  </tbody>
							</table>
						</div>
					</div>
				</div>
				
				<script>	
					$('#datatable').DataTable({
						"pagingType": "simple_numbers",
						"lengthMenu": [[10, 100, -1], [10, 100, "All"]],
						"dom": '<"top">rt"<"rightcolumn"><"clear">p',
						"bSort": true,
						"ordering": true,
						"bAutoWidth": false,
						"aoColumns": [
              { "sWidth": '70px' },
              { "sWidth": null },
              { "sWidth": null },
              { "sWidth": null },
              { "sWidth": null },
              { "sWidth": null }
            ],

            //"columnDefs": [ {
            //"targets": 0,
            ///"data": null,
            //"orderable": false,
            //"className": 'details-control',
            //"defaultContent": '<button><i class="fa fa-plus" aria-hidden="true"></i> oi</button>'
            //} ]
					});	
					
					var table = $('#datatable').DataTable();
					$('#datatable'+' tbody').on('click', 'tr', function () {
						 
					     if ($(this).hasClass('selected') ) {
					    	 $(this).removeClass('selected');
							 //alert("desmarquei");
					    	 desabilitar_botao('#bt_excluir');
							 desabilitar_botao('#bt_alterar');
					    	 $('#bt_excluir').addClass('link_desabilitado');
							 $('#bt_alterar').addClass('link_desabilitado');
					     }
					     else {
							 //alert("marquei");
					    	 table.$('tr.selected').removeClass('selected');
					    	 $(this).addClass('selected');
					    	 habilitar_botao('#bt_excluir');
							 habilitar_botao('#bt_alterar');
							 $('#bt_excluir').removeClass('link_desabilitado');
							 $('#bt_alterar').removeClass('link_desabilitado');
					    	 
					    	//alert("Quero procurar os detalhes de: "+table.cell('.selected', 0).data());
					    	/*
					    	$.ajax({
								url: 'get_detalhes_protocolo/'+table.cell('.selected', 0).data(),
								type: 'get', //this is the default though, you don't actually need to always mention it
								success: function(data) {
									///alert(data['data']);
									
									$('#lb_emitido_por').text(data['emitido_por']);
									var table_detalhes = $('#datatable_detalhes').DataTable();
									table_detalhes.rows().remove();
									table_detalhes.rows.add(data['data']).draw();
									
									
									$("#datatable_detalhes tbody tr td").addClass("center_align");
									$("#datatable_detalhes tbody tr td:first-child").removeClass("centralizado").addClass("left_align");
									
									
									//alert("consegui?");
								  
								},
								failure: function(data) { 
									alert('Got an error dude');
								}
							}); 
							*/
					    	 
					     }
					     
					     $('#bt_excluir').click( function () {
							$.ajax({
								url: '/protocolo/documento/excluir/'+table.cell('.selected', 0).data(),
								type: 'get', //this is the default though, you don't actually need to always mention it
								success: function(data) {
									
									/*if (data=="SUCESS"){
										alert("Deu Certo Carai",data);
									}
									
									else{
										alert("Erro na exclusão! ",data);
									}
									*/
									table.row('.selected').remove().draw( false );
									$('#bt_excluir').addClass('link_desabilitado');
									$('#bt_alterar').addClass('link_desabilitado');
								},
								failure: function(data) { 
									alert('Erro! Falha na exclusão do registro');
								}
							}); 
							
					        
					        //alert("Vamos confirmar.. "+table.cell('.selected', 0).data());
					        //$("#protocolo_id").val(table.cell('.selected', 0).data());
					        //alert("Vamos confirmar.. "+table.cell('.selected', 0).data());
					     } );
							
					});
					
					$('#datatable tbody').on( 'click', 'button', function () {
					    var data = table.row( $(this).parents('tr') ).data();
					    alert( data[0] +"'s salary is: "+ data[ 5 ] );
					} );

                    jQuery(document).ready(function($) {
                        $(".clickable-row").click(function() {
                            window.location = $(this).data("href");
                        });
                    });
				</script>
				
				<div class='row'>
          {% if meus_repositorios %}
          <div class="col-lg-2 col-md-2 col-sm-2 col-xs-6" style='margin-top:0px;'>
          {% else %}
          <div class="col-lg-2 col-md-2 col-sm-2 col-xs-6" style='margin-top:6px;'>
          {% endif %}
          <label class='left_align'><sub>Buscar por:</sub></label>
          <select id='buscar_por' class='form-control'>
            <option value="0">Repositório</option>
            <option value="1" selected>Projeto</option>
            <option value="2">Linguagem</option>
          </select>
					</div>

					{% if meus_repositorios %}
					<div class="col-lg-4 col-md-4 col-sm-5 col-xs-6" style='margin-left:-20px;margin-top: 25px;'>
          {% else %}
          <div class="col-lg-4 col-md-4 col-sm-5 col-xs-6" style='margin-left:-20px;margin-top: 31px;'>
          {% endif %}
						<input type="text" id="search" class="form-control" autofocus placeholder="Consultar..">
					</div>

				</div>
			</div>
		</div>
		<!-- /.panel -->
	</div>
	<!-- /.row -->
</div>

<br>

{% include "componentes/mensagem.html" with messages=messages %}
{% endblock %}

{% block recursos_complementares %}
{% load staticfiles %}
<script type="text/javascript" src="{% static 'scripts/mask.js' %}"></script>

<script type="text/javascript">
    $('#bt_adicionar').click( function () {
        $('#atualizando_icone').addClass("fa fa-spinner fa-pulse fa-1x fa-fw").show();

        $.ajax({
            url: '/projeto/analisar',
            type: 'get', //this is the default though, you don't actually need to always mention it
            success: function(data) {
                alert(data);
                $('#atualizando_icone').removeClass("fa fa-spinner fa-pulse fa-1x fa-fw").hide();
                window.location.reload();
                //table.row('.selected').remove().draw( false );
                //$('#bt_excluir').addClass('link_desabilitado');
                //$('#bt_alterar').addClass('link_desabilitado');
            },
            failure: function(data) {
                alert('Erro! Falha na exclusão do registro');
            }
        });
    });

</script>


<script type="text/javascript">
    $('#bt_adicionar').click( function () {
        $("#bt_submit_documento").attr('name','adicionar_documento');
        $("#bt_submit_documento").text('Adicionar');
        //alert("Quero adicionar");
    });

    $('#bt_alterar').click( function () {
        $("#bt_submit_documento").attr('name','alterar_documento');
        $("#bt_submit_documento").attr('value',table.cell('.selected', 0).data());
        $("#bt_submit_documento").text('Alterar');

        $.ajax({
            url: '/protocolo/documento/'+table.cell('.selected', 0).data(),
            type: 'get', //this is the default though, you don't actually need to always mention it
            success: function(data) {
                $('#documento').val(data[0]);
                $('#descricao').val(data[1]);

            },
            failure: function(data) {
                alert('Erro! Falha na exclusão do registro');
            }
        });

    });

    //
</script>

<script>
function carregar_estado_atual(){
  $("#atualizar_metricas_icone").attr("class",'fa fa-refresh fa-spin fa-3x fa-1x');
  $("#box_project_metrics").css({"opacity": "0.2"});
  $.ajax({
    type: "POST",
    url: "/api/projeto/consultar_metricas/{{ projeto.id }}/",
    data: {
      csrfmiddlewaretoken: '{{ csrf_token }}'
    },

    success: function (data) {
      atualizar_metricas("complexidade",data.complexidade_projeto,data.complexidade_global,data.complexidade_percentual,data.complexidade_resultado);
      atualizar_metricas("duplicacao",data.duplicacao_projeto,data.duplicacao_global,data.duplicacao_percentual,data.duplicacao_resultado);
      atualizar_metricas("divida_tecnica",data.divida_tecnica_projeto,data.divida_tecnica_global,data.divida_tecnica_percentual,data.divida_tecnica_resultado);
      atualizar_metricas("comentarios",data.comentarios_projeto,data.comentarios_global,data.comentarios_percentual,data.comentarios_resultado);
      atualizar_metricas("codesmells",data.codesmell_projeto,data.codesmell_global,data.codesmell_percentual,data.codesmell_resultado);
      setTimeout(function(){
        $("#box_project_metrics").css({"opacity": "1"});
        $("#atualizar_metricas_icone").attr("class",'fa fa-refresh');
      }, 2000);

      /*$("#complexidade_projeto").text(data.complexidade_projeto);
      $("#complexidade_global").text(data.complexidade_global);
      $("#progress_complexidade").attr("style", "width:"+data.complexidade_percentual+"%");
      verifica_comparacao(data.complexidade_resultado,"complexidade")*/

      /*$("#duplicacao_projeto").text(data.duplicacao_projeto);
      $("#duplicacao_global").text(data.duplicacao_global);
      $("#progress_duplicacao").attr("style", "width:"+data.duplicacao_percentual+"%");*/


      //alert("FOI?"+data.complexidade_percentual)
      //var resultado = data.complexidade_global;

      /*if (resultado['success'] == true) {
        var plano = resultado['message'];
        $scope.planos.push(plano);
        $scope.selecionar_plano(plano,$scope.planos.length-1);
        $scope.resetar_formulario_plano();
        $scope.$apply();
      }

      else {
        alert(resultado["message"]);
      }*/

    },
    failure: function (data) {
      alert('Erro! Falha na execução do ajax');
      setTimeout(function(){
        $("#box_project_metrics").css({"opacity": "1"});
        $("#atualizar_metricas_icone").attr("class",'fa fa-refresh');
      }, 2000);
    }
  });


}

function verifica_comparacao(comparacao,metrica){

  if (comparacao){
    $("#box_"+metrica).attr("class","box_metric box box-primary");
    $("#box_"+metrica).find(".box_metric_hand").css({"color": "#3366cc"});
    $("#progress_"+metrica).addClass('progress-bar-aqua')
    $("#"+metrica+"_icone").attr('class','fa fa-thumbs-o-up fa-lg');
  }
  else{
    $("#box_"+metrica).attr("class","box_metric box box-danger");
    $("#box_"+metrica).find(".box_metric_hand").css({"color": "#cc0000"});
    $("#progress_"+metrica).addClass('progress-bar-danger')
    $("#"+metrica+"_icone").attr('class','fa fa-thumbs-o-down fa-lg');
  }
}

function atualizar_metricas(metrica,valor_projeto,valor_referencia,relacao_comparacao,resultado_comparacao){
  $("#"+metrica+"_projeto").text(valor_projeto);
  $("#"+metrica+"_global").text(valor_referencia);
  $("#progress_"+metrica).attr("style", "width:"+relacao_comparacao+"%");

  verifica_comparacao(resultado_comparacao,metrica);
}

function atualizar_metricas_projeto(){
  $("#progress_complexidade").attr("style", "width:0%");
  $("#progress_duplicacao").attr("style", "width:0%");
  $("#progress_divida_tecnica").attr("style", "width:0%");
  $("#progress_comentarios").attr("style", "width:0%");
  $("#progress_codesmells").attr("style", "width:0%");
  setTimeout(carregar_estado_atual(), 1000);}
</script>

<script>
jQuery(document).ready(function(){
	$("#data_entrega").mask("99/99/9999");
	$("#filtrar_desde").mask("99/99/9999");
	$("#filtrar_ate").mask("99/99/9999");
  $("#hora_entrega").mask("99:99");
  carregar_estado_atual();
});
</script>

<script>
    $('#search').on( 'keyup', function () {
        var table = $('#datatable').DataTable();
        var campo = $('#buscar_por').val();
        table.columns(campo).search(this.value).search(this.value).draw();              // GERAL
    });
</script>

<script>
$('#buscar_por').change(function() {
    var table = $('#datatable').DataTable();
    var campo = $('#buscar_por').val();
    table.search('').columns().search( '' ).draw(); // reseta a pesquisa
    table.columns(campo).search($('#search').val()).draw();
});
</script>







<script type="text/javascript">
//$(document).ready(function() {
////	$("#datatable"+' tbody').on( 'click', 'tr', seleciona_linha("#datatable",$(this),true));
//});
</script>


<script>
$('.modal').on('hidden.bs.modal', function(){
	$(this).find('form')[0].reset();
	$("#recebido_por").val('');
	$("#documento").val('');
	$("#observacao_entrega").val('');
    //alert("resetei o form?");
});
</script>

<script>
$(document).ready(function() {
	
	$('#bt_excluir').addClass('link_desabilitado');
	$('#visualizar_protocolo').addClass('link_desabilitado');
	
	
	{% if erro %}
    	$('#myModal').modal('show');
    	BootstrapDialog.show({
	        message: $("Tentando")
	    });
    
    {% else %}
		$('#myModal').modal('hide');
	{% endif %}
});
</script>




<script type="text/javascript">
//$(document).ready(function() {
	//alert("Olha o que temos de documentos: {{ dados }}");
//	{% if dados %}
		//alert("vim configurar a exclusao e tenho dados..");
//		configurar_datatable_selecionavel("#datatable","#bt_apagar","{{ dados|length }}");
		
//	{% else %}
		//alert("vim configurar a exclusaom mas nao tenho dados..");
//		configurar_datatable_selecionavel("#datatable","#bt_apagar","{{ dados|length }}");
//		desabilitar_botao("#bt_gerar_protocolo");
//	{% endif %}	
//});
</script>

<script type="text/javascript">
//$(document).ready(function() {
//	$("#datatable"+' tbody').on( 'click', 'tr', seleciona_linha("#datatable",$(this),true));
//	});
</script>


<script type="text/javascript">
$('#visualizar_protocolo').click( function () {
    //alert("cliquei pra visualizar protocolo"+table.cell('.selected', 0).data());
	//document.getElementById('visualizar_protocolo').target='_blank';
	document.getElementById('visualizar_protocolo').href = '/protocolo/visualizar/'+table.cell('.selected', 0).data();
	//setTimeout(function(){ window.location.href = ('/protocolo/visualizar/'+table.cell('.selected', 0).data()); }, 500);
	//window.location.href = '/protocolo/visualizar/'+table.cell('.selected', 0).data();
	//window.location.reload();
	//setTimeout(function () {  }, 3);

 });
</script>



<script type="text/javascript">
	//function visualizar_protocolo(){

	  //  var link = document.getElementById("visualizar_protocolo");
	  //  alert("cliquei pra visualizar protocolo"+table.cell('.selected', 0).data());

	 //   document.getElementById('visualizar_protocolo').href='/protocolo/visualizar/'+table.cell('.selected', 0).data());
	 //   window.location.href = ('/protocolo/visualizar/'+table.cell('.selected', 0).data());




		//$("#protocolo_id").val(table.cell('.selected', 0).data());
		//document.getElementById('visualizar_protocolo').href='/protocolo/visualizar/'+table.cell('.selected', 0).data())';
		//setTimeout(function(){ window.location.href = ('/protocolo/visualizar/'+table.cell('.selected', 0).data()); }, 1000);

	//}

</script>


<script>
$(function() {
	$("#data_entrega").datepicker({
		  dayNames: [ "Domingo", "Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado" ],
		  monthNames: [ "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho","Agosto","Setembro","Outubro","Novembro","Dezembro" ],
		  dayNamesMin: [ "D", "S", "T", "Q", "Q", "S", "S" ],
		  dateFormat: 'dd/mm/yy'
	});
});

$(function(){
	$("#filtrar_desde").datepicker({
		  dayNames: [ "Domingo", "Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado" ],
		  monthNames: [ "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho","Agosto","Setembro","Outubro","Novembro","Dezembro" ],
		  dayNamesMin: [ "D", "S", "T", "Q", "Q", "S", "S" ],
		  dateFormat: 'dd/mm/yy'
	});
});

$(function(){
	$("#filtrar_ate").datepicker({
		  dayNames: [ "Domingo", "Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado" ],
		  monthNames: [ "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho","Agosto","Setembro","Outubro","Novembro","Dezembro" ],
		  dayNamesMin: [ "D", "S", "T", "Q", "Q", "S", "S" ],
		  dateFormat: 'dd/mm/yy'
	});
});
</script>

<script type="text/javascript">
$('#codigo_postal').blur(function(){
	$.ajax({
		url: '/get_detalhes_protocolo/'+$('#codigo_postal').val(),
	    type: 'get', //this is the default though, you don't actually need to always mention it
	    success: function(data) {
	    	$('#endereco').val(data[0]);
	    	$('#bairro').val(data[1]);
	    	$('#municipio').val(data[2]);
	    	$('#codigo_municipio').val(data[3]);
	    	$('#estado').val(data[4]);
	    	$('#pais').val(data[5]);
	        $('#numero_endereco').focus();
	      //alert(data);
	    },
	    failure: function(data) {
	        alert('Got an error dude');
	    }
	});
});
</script>

<script>
$('#datatable_detalhes').DataTable({
	"pagingType": false,
	"lengthMenu": [[10, 100, -1], [10, 100, "All"]],
	"dom": '<"top">rt"<"rightcolumn"><"clear">',
	"bSort": false,
	"ordering": false,
	"bAutoWidth": false
});

//alert("defini o detalhe");

</script>

<script type="text/javascript">
function selecionar_filtro_cliente(){

	var destinatario = $('#select_filtrar_por_cliente').val();
	$("#filtrar_por_cliente").val(destinatario);

}
</script>

<!-- jvectormap -->
<script type="text/javascript" src="{% static 'plugins/jvectormap/jquery-jvectormap-world-mill-en.js' %}"></script>
<script type="text/javascript" src="{% static 'plugins/jvectormap/jquery-jvectormap-1.2.2.min.js' %}"></script>

{% endblock %}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       